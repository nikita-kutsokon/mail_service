generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "mongodb"
  url      = env("DATABASE_URL")
}

model Contact {
  id        String @id @default(auto()) @map("_id") @db.ObjectId
  firstName String
  lastName  String

  age                 Int
  city                String
  email               String @unique
  gender              String
  country             String
  timezone            String
  occupation          String
  sourceOfReferral    String
  eduQuestDecision    String
  intershipMotivation String

  birthDate                DateTime  @db.Date
  eduQuestSelectedDateTime DateTime?

  isSubscribed               Boolean @default(true)
  isEqParticipationConfirmed Boolean @default(false)

  createdAt DateTime @default(now()) @db.Date

  listIds           String[]            @db.ObjectId
  lists             ContactstList[]     @relation(fields: [listIds], references: [id])
  ContactsActions   ContactsActions[]
  ScheduledMail     ScheduledMail[]
  SentMail          SentMail[]
  UnsubscribedUsers UnsubscribedUsers[]
}

model ContactstList {
  id                String    @id @default(auto()) @map("_id") @db.ObjectId
  name              String    @unique
  eduQuestStartDate DateTime? @unique
  createdAt         DateTime  @default(now()) @db.Date

  contactIds String[]  @db.ObjectId
  contacts   Contact[] @relation(fields: [contactIds], references: [id])
}

model ScheduledMail {
  id String @id @default(auto()) @map("_id") @db.ObjectId

  contactId String  @db.ObjectId
  contact   Contact @relation(fields: [contactId], references: [id], onDelete: Cascade)

  templateId String       @db.ObjectId
  template   MailTemplate @relation(fields: [templateId], references: [id])

  timeZone           String
  scheduledDate      DateTime @db.Date
  useContactTimezone Boolean

  mailingAutomationId String?            @db.ObjectId
  mailingAutomation   MailingAutomation? @relation(fields: [mailingAutomationId], references: [id])
  SenderProfile       SenderProfile?     @relation(fields: [senderProfileId], references: [id])
  senderProfileId     String?            @db.ObjectId
}

model SentMail {
  id String @id @default(auto()) @map("_id") @db.ObjectId

  contactId String  @db.ObjectId
  contact   Contact @relation(fields: [contactId], references: [id], onDelete: Cascade)

  templateId String       @db.ObjectId
  template   MailTemplate @relation(fields: [templateId], references: [id])

  timeZone      String
  scheduledDate DateTime @db.Date

  emailId String @unique

  emailStatus     EmailStatus?   @default(PENDING)
  SenderProfile   SenderProfile? @relation(fields: [senderProfileId], references: [id])
  senderProfileId String?        @db.ObjectId
}

model MailTemplate {
  id                String   @id @default(auto()) @map("_id") @db.ObjectId
  name              String
  googleDriveFileId String
  createdAt         DateTime @default(now()) @db.Date

  sentMails                SentMail[]
  scheduledMails           ScheduledMail[]
  ContactsActions          ContactsActions[]
  AutomationScheduledMails AutomationScheduledMails[]
}

model SenderProfile {
  id    String @id @default(auto()) @map("_id") @db.ObjectId
  name  String
  email String @unique

  scheduledMails ScheduledMail[]
  sentMails      SentMail[]
}

model ContactDataPlacehodelr {
  id               String @id @default(auto()) @map("_id") @db.ObjectId
  contactFieldName String
  placeholderTag   String
}

model Users {
  id       String  @id @default(auto()) @map("_id") @db.ObjectId
  email    String  @unique
  password String
  name     String
  token    String?
}

model ContactsActions {
  id String @id @default(auto()) @map("_id") @db.ObjectId

  contactId String  @db.ObjectId
  contact   Contact @relation(fields: [contactId], references: [id])

  typeOfActivity TypeOfActivity

  templateId String       @db.ObjectId
  template   MailTemplate @relation(fields: [templateId], references: [id])

  activityDescription String
  createdAt           DateTime @default(now()) @db.Date
}

model UnsubscribedUsers {
  id String @id @default(auto()) @map("_id") @db.ObjectId

  contactId String  @db.ObjectId
  contact   Contact @relation(fields: [contactId], references: [id])

  activityDescription String
  createdAt           DateTime @default(now()) @db.Date
}

model MailingAutomation {
  id                       String                     @id @default(auto()) @map("_id") @db.ObjectId
  name                     String
  automationScheduledMails AutomationScheduledMails[]

  scheduledMails ScheduledMail[]
}

model AutomationScheduledMails {
  id String @id @default(auto()) @map("_id") @db.ObjectId

  templateId String       @db.ObjectId
  template   MailTemplate @relation(fields: [templateId], references: [id])

  timeZone           String
  useContactTimezone Boolean
  scheduledDate      DateTime @db.Date

  mailingAutomationId String            @db.ObjectId
  mailingAutomation   MailingAutomation @relation(fields: [mailingAutomationId], references: [id])
}

enum EmailStatus {
  PENDING
  OPENED
}

enum TypeOfActivity {
  EMAIL
  LINK
}
